@model UpdateBookViewModel

<div class="content-wrapper">
    <div class="container-fluid">
        <div class="row">
            <div class="col">
                @if (Model.ProductActionType == ProductActionType.Create)
                {
                    <h3 class="content-header">ثبت کتاب جدید</h3>
                }
                else if (Model.ProductActionType == ProductActionType.Update)
                {
                    <h3 class="content-header">ویرایش کتاب</h3>
                }
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title-wrap bar-success">
                        </div>
                        <div class="text-danger">
                            @Html.ValidationSummary()
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="px-3">
                            <form id="frm" class="form" asp-area="Admin" asp-controller="Book" asp-action="Update" method="post" enctype="multipart/form-data">
                                <div class="form-body">
                                    <div class="row">
                                        <div class="col-xl-4 col-lg-6 col-md-12 mb-1">
                                            <fieldset class="form-group">
                                                <input type="hidden" id="Id" name="Id" asp-for="Id" />
                                                <input type="hidden" id="ProductActionType" name="ProductActionType" asp-for="ProductActionType" />
                                                <label for="basicInput">عنوان کتاب</label>
                                                <input type="text" class="form-control" id="Title" name="Title" asp-for="Title">
                                            </fieldset>
                                        </div>
                                        <div class="col-xl-4 col-lg-6 col-md-12 mb-1">
                                            <fieldset class="form-group">
                                                <label for="basicInput">شابک(ISBN)</label>
                                                <input type="text" class="form-control" id="ISBN" name="ISBN" asp-for="ISBN">
                                            </fieldset>
                                        </div>
                                        <div class="col-xl-4 col-lg-6 col-md-12 mb-1">
                                            <fieldset class="form-group">
                                                <label for="basicInput">نویسنده</label>
                                                <input type="text" class="form-control" id="Author" name="Author" asp-for="Author">
                                            </fieldset>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xl-4 col-lg-6 col-md-12 mb-1">
                                            <fieldset class="form-group">
                                                <input type="hidden" id="Id" name="Id" asp-for="Id" />
                                                <input type="hidden" id="ProductActionType" name="ProductActionType" asp-for="ProductActionType" />
                                                <label for="basicInput">مترجم</label>
                                                <input type="text" class="form-control" id="Translator" name="Translator" asp-for="Translator">
                                            </fieldset>
                                        </div>
                                        <div class="col-xl-4 col-lg-6 col-md-12 mb-1">
                                            <fieldset class="form-group">
                                                <label for="basicInput">نوبت چاپ</label>
                                                <input type="text" class="form-control" id="Edition" name="Edition" asp-for="Edition">
                                            </fieldset>
                                        </div>
                                        <div class="col-xl-4 col-lg-6 col-md-12 mb-1">
                                            <div class="row">
                                                <div class="col-xl-6 col-lg-6 col-md-6 mb-1">
                                                    <fieldset class="form-group">
                                                        <label for="basicInput">سال انتشار</label>
                                                        <input type="text" class="form-control" id="PublishYear" name="PublishYear" asp-for="PublishYear">
                                                    </fieldset>
                                                </div>
                                                <div class="col-xl-6 col-lg-6 col-md-6 mb-1">
                                                    <fieldset class="form-group">
                                                        <label for="basicInput">ماه انتشار</label>
                                                        <input type="text" class="form-control" id="PublishMonth" name="PublishMonth" asp-for="PublishMonth">
                                                    </fieldset>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xl-3 col-lg-6 col-md-12 mb-1">
                                            <fieldset class="form-group">
                                                <label for="basicInput">تعداد صفحات</label>
                                                <input type="text" class="form-control" id="Pages" name="Pages" asp-for="Pages">
                                            </fieldset>
                                        </div>
                                        <div class="col-xl-3 col-lg-6 col-md-12 mb-1">
                                            <fieldset class="form-group">
                                                <label for="basicInput">قطع</label>
                                                <select class="form-control" id="Size" name="Size" asp-for="Size">
                                                    <option value="0">وزیری</option>
                                                    <option value="1">رقعی</option>
                                                    <option value="2">رحلی</option>
                                                    <option value="3">جیبی</option>
                                                </select>
                                            </fieldset>
                                        </div>
                                        <div class="col-xl-3 col-lg-6 col-md-12 mb-1">
                                            <fieldset class="form-group">
                                                <label for="basicInput">جلد</label>
                                                <select class="form-control" id="CoverType" name="CoverType" asp-for="CoverType">
                                                    <option value="0">نرم</option>
                                                    <option value="1">سخت</option>
                                                </select>
                                            </fieldset>
                                        </div>
                                        <div class="col-xl-3 col-lg-6 col-md-12 mb-1">
                                            <fieldset class="form-group">
                                                <label for="basicInput">موجودی</label>
                                                <input type="text" class="form-control" id="Quantity" name="Quantity" asp-for="Quantity">
                                            </fieldset>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <fieldset class="form-group">
                                                <label for="basicInput">دسته بندی</label>
                                                <input type="hidden" id="selectedTags" name="CategoriesString" asp-for="CategoriesString" />
                                                <select multiple data-placeholder="انتخاب کنید">
                                                    @foreach (var category in ViewBag.CategoryList as List<CategoryViewModel>)
                                                    {
                                                        if (Model.Categories != null && Model.Categories.Any(x => x.Id == category.Id))
                                                        {
                                                            <option selected>@category.Name</option>
                                                        }
                                                        else
                                                        {
                                                            <option>@category.Name</option>
                                                        }
                                                    }
                                                </select>
                                            </fieldset>
                                        </div>
                                        <div class="col-6">
                                            <fieldset class="form-group">
                                                <label for="basicInput">انتشارات</label>
                                                <select class="custom-select d-block w-100" id="PublicationId" name="PublicationId" asp-for="PublicationId"
                                                        asp-items="@(ViewBag.PublicationsList)">
                                                    <option value="0">انتخاب کنید</option>
                                                </select>
                                            </fieldset>
                                        </div>
                                    </div>
                                    
                                    <!--Image container -->

                                    <div class="row">
                                        <div class="col-12">
                                            <p class="danger">پس از ویرایش عکس ها روی دکمه ذخیره کلیک کنید.</p>
                                            <p class="danger">طبق تنظیمات فقط 4 تصویر قابل بارگذاری است.</p>
                                        </div>
                                    </div>

                                    <div class="row"
                                         data-type="imagesloader"
                                         data-errorformat="Accepted file formats"
                                         data-errorsize="Maximum size accepted"
                                         data-errorduplicate="File already loaded"
                                         data-errormaxfiles="Maximum number of images you can upload"
                                         data-errorminfiles="Minimum number of images to upload"
                                         data-modifyimagetext="Modify image">

                                        <!-- Image file input -->
                                        <input type="file" multiple="multiple" id="imageLoaderFileInput" name="imageLoaderFileInput" style="display:none;" />
                                        <input type="hidden" id="imageNamesToDelete" name="imageNamesToDelete" asp-for="ImageNamesToDelete"/>
                                        <!-- Progress bar -->
                                        <div class="col-12 order-1 mt-2">
                                            <div data-type="progress" class="progress" style="height: 25px; display:none;">
                                                <div data-type="progressBar" class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar" style="width: 100%;">Load in progress...</div>
                                            </div>
                                        </div>

                                        <!-- Model -->
                                        <div data-type="image-model" class="col-4 pl-2 pr-2 pt-2" style="max-width:200px; display:none;">

                                            <div class="ratio-box text-center" data-type="image-ratio-box">
                                                <img data-type="noimage" class="btn btn-light ratio-img img-fluid p-2 image border dashed rounded" src="~/lib/image-loader/img/photo-camera-gray.svg" style="cursor:pointer;">
                                                <div data-type="loading" class="img-loading" style="color:#218838; display:none;">
                                                    <span class="fa fa-2x fa-spin fa-spinner"></span>
                                                </div>
                                                <img data-type="preview" class="btn btn-light ratio-img img-fluid p-2 image border dashed rounded" src="" style="display: none; cursor: default;">
                                                <span class="badge badge-pill badge-success p-2 w-50 main-tag" style="display:none;">Main</span>
                                            </div>

                                            <!-- Buttons -->
                                            <div data-type="image-buttons" class="row justify-content-center mt-2">
                                                <button data-type="add" class="btn btn-outline-success" type="button">Add<span class="fa fa-plus mr-2"></span></button>
                                                <button data-type="btn-modify" type="button" class="btn btn-outline-success m-0" data-toggle="popover" data-placement="right" style="display:none;">
                                                    Modify<span class="fa fa-pencil-alt mr-2"></span>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Popover operations -->
                                        <div data-type="popover-model" style="display:none">
                                            <div data-type="popover" class="ml-3 mr-3" style="min-width:150px;">
                                                <div class="row">
                                                    <div class="col p-0">
                                                        <button data-operation="main" class="btn btn-block btn-success btn-sm rounded-pill" type="button"><span class="fa fa-angle-double-up mr-2"></span>Main</button>
                                                    </div>
                                                </div>
                                                <div class="row mt-2">
                                                    <div class="col-6 p-0 pr-1">
                                                        <button data-operation="left" class="btn btn-block btn-outline-success btn-sm rounded-pill" type="button"><span class="fa fa-angle-left mr-2"></span>Left</button>
                                                    </div>
                                                    <div class="col-6 p-0 pl-1">
                                                        <button data-operation="right" class="btn btn-block btn-outline-success btn-sm rounded-pill" type="button">Right<span class="fa fa-angle-right ml-2"></span></button>
                                                    </div>
                                                </div>
                                                <div class="row mt-2">
                                                    <div class="col-6 p-0 pr-1">
                                                        <button data-operation="rotateanticlockwise" class="btn btn-block btn-outline-success btn-sm rounded-pill" type="button"><span class="fas fa-undo-alt mr-2"></span>Rotate</button>
                                                    </div>
                                                    <div class="col-6 p-0 pl-1">
                                                        <button data-operation="rotateclockwise" class="btn btn-block btn-outline-success btn-sm rounded-pill" type="button">Rotate<span class="fas fa-redo-alt ml-2"></span></button>
                                                    </div>
                                                </div>
                                                <div class="row mt-2">
                                                    <button data-operation="remove" class="btn btn-outline-danger btn-sm btn-block" type="button"><span class="fa fa-times mr-2"></span>Remove</button>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="form-group row">
                                        <div class="input-group">
                                            <!--Hidden file input for images-->
                                            <input id="files" type="file" name="files[]" data-button="" multiple="" accept="image/jpeg, image/png, image/gif," style="display:none;">
                                        </div>
                                    </div>

                                    <div class="row mt-2">
                                        <div class="col-12">
                                            <button type="submit" class="btn mr-1 btn-success col-12">ذخیره</button>
                                        </div>
                                    </div>
                                    @* <img src="/../BookImage/3c0f8a98-3f80-4b25-b4ac-a4f6f00456a8.png" /> *@
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



@section Scripts {

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

    <!-- Font awesome -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/js/all.min.js" crossorigin="anonymous"></script>

    <script src="~/lib/image-loader/appendFilesToFileInput.js"></script>

    <script src="~/lib/image-loader/jquery.imagesloader-1.0.1.js"></script>

    <script src="~/lib/tag-input/script.js"></script>

    <script>

        $(document).ready(function () {

            const model = @Html.Raw(Json.Serialize(Model));

            //Image loader var to use when you need a function from object
            var imagesToLoad = null;

            if (model.images.length > 0) {

                imagesToLoad = [];

                model.images.forEach(imageItem => {
                    const imageObject = { "Url": imageItem.url, "Name": imageItem.originalName }

                    imagesToLoad.push(imageObject);
                });
            }

            // Create image loader plugin
            var imagesloader = $('[data-type=imagesloader]').imagesloader({
                maxFiles: 4
                , minSelect: 1
                , imagesToLoad: imagesToLoad
            });
        });

    </script>
}